# 001_開発環境

## 概要

このパッケージでスキャフォールディングされるプロジェクトの開発環境としてDockerを前提とした構成を採用する。

## 課題

開発者や実行環境の差異に起因する問題を防ぐことが主要な課題である。具体的には、ユーザがローカルにPHP8.2をインストールしているが本番環境ではPHP8.4を想定していた、という事態を防ぐ必要がある。

## 決定事項

スキャフォールディングで生成されるプロジェクトの開発環境としてDockerを前提とした構成とする。また、企業VPN環境での証明書問題に対応するため、カスタムCA証明書のサポートも含める。

## ステータス

Accepted

## 詳細

### 前提

- 複数の案件を掛け持ちする開発者が存在する
- 各案件で異なるPHPバージョンが要求される可能性がある
- 企業VPN環境（Cloudflare WARPなど）での開発が想定される
- AI開発時代において、QAやテストの実行頻度が高くなる

### 制約

- 実行速度がローカル環境と比較して劣る
- 開発者にDockerの基本的な知識を要求する
- ディスク容量やメモリの消費量が増加する

### 検討した選択肢

#### 1. ローカル直接インストール
- **概要**: 開発者のローカル環境に直接PHPをインストールする前提
- **問題点**: 複数案件でのPHPバージョン差異に対応できない
- **判定**: 考慮する価値もないとして不採用

#### 2. phpenvによるバージョン管理
- **概要**: phpenvを使用してPHPバージョンを切り替える前提
- **問題点**: 「phpenvはあまりにも何もしていないのに壊れすぎる」（参考: https://speakerdeck.com/ttskch/phpenvyamemasita?slide=9）
- **判定**: 信頼性の問題により不採用
- **注意**: 2021年時点の情報のため現在は改善している可能性もあるが、検証は行わなかった

#### 3. direnvによるバージョン管理
- **概要**: direnvを使用した環境変数ベースのバージョン管理を前提
- **問題点**: 
  - ローカル直接インストールとほぼ変わらない
  - ユーザに「どのバージョンを使うか」を強制できない
  - チーム開発に不向き
- **判定**: チーム開発での制御性不足により不採用

#### 4. Docker（採用）
- **メリット**:
  - 環境差異による問題を根本的に解決
  - チーム全体で統一された環境を保証
  - 企業VPN環境での証明書問題にも対応可能
- **デメリット**:
  - ローカル実行と比較した圧倒的な実行速度の遅さ
  - AI開発時代における開発体験の阻害要因となる可能性
- **判定**: 環境差異防止のメリットがデメリットを上回ると判断し採用

### 企業環境への対応

所属する特定の企業環境を想定しているが、汎用的に使えるものとして設計した。特に企業内VPN（Cloudflare WARPなど）環境での証明書エラーを防ぐ目的で、カスタムCA証明書への対応を含めている。

### 決定のタイミング

プロジェクト開始時から明確に決定していた。これは環境差異を解決する手段として、現在もっとも強力なものだと考えているからである。
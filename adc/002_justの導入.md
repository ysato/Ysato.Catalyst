# 002_justの導入

## 概要

このパッケージでスキャフォールディングされるプロジェクトのコマンドランナーとしてjustを採用する。

## 課題

複雑なDockerコマンドの簡素化が目的である。複雑なコマンドはただでさえ頭を使っている開発者をさらに混乱させる材料となり、それは「Dockerを利用することを放棄しローカルで同じ環境を直接インストールしたほうが楽だな」という気持ちに向かわせてしまう。それは最悪の結末であり、環境差異に起因する問題があちこちで起こることになる。

## 決定事項

スキャフォールディングで生成されるプロジェクトのコマンドランナーとしてjustを採用する。

## ステータス

Accepted

## 詳細

### 前提

- Dockerベースの開発環境を採用済み
- 複雑なDockerコマンドが開発者の負担となっている
- Windows環境での開発者が多い
- 開発者に新しいツールへの感度を持ってもらいたい

### 制約

- 開発者にjustのインストールを要求する
- 新しいツールへの学習コストが発生する

### 検討した選択肢

#### 1. Make/Makefile
- **メリット**:
  - 一部の環境ではインストール不要
  - 開発者が慣れている可能性が高い
  - 実績のあるツール
- **デメリット**:
  - クロスプラットフォーム性に課題（特にWindows）
  - 引数を環境変数として扱ってしまう
  - オプションのように複数の引数に対応できない
- **判定**: 引数処理の問題により不採用

#### 2. just（採用）
- **メリット**:
  - クロスプラットフォーム対応
  - 引数処理の柔軟性
  - 開発者の新技術への感度向上に寄与
  - Makeの問題点を解消するために生まれたツール
- **デメリット**:
  - インストールが必要
  - 学習コストが発生
- **判定**: メリットがデメリットを上回ると判断し採用

### Composer scriptsとの関係

Composer scriptsは実際に使用しているが、justとは比較対象ではない。Composer scriptsだけでは以下の問題がある：

- 環境差異問題を防げない
- Docker自体のbuildやOpenAPIのリンターなどを集約する場所として不十分

そのため、DockerとComposer scriptsを統合的に管理する手段としてjustが必要である。

### 副次的効果

開発者に新しいツールに触れてもらいたいという意図もある。Makeでは対応できない問題を解消するべく生まれてきたツールであるjustは今後も利用することになるだろう。そういう意味で慣れてもらいたいという気持ちと、新しいツールに対するアンテナを張ってもらいたいという気持ちがある。

### デメリットの認識と対応

ユーザにjustのインストールを要求するコストはデメリットとして認識していた。ただしWindowsではもともとmakeコマンドはインストールが必要であったため、特別に重いコストだとは思っていない。チーム内での普及や説明コストはあまり問題視していない。

### 決定のタイミング

コマンドランナーの導入は最初から決まっていたが、justかMakeかはギリギリまで迷っていた。Makeの方がインストール不要な環境もあり、ユーザも慣れているだろうという利点があったが、引数の問題に気付いて明確にjustに決定した。

### 参考資料

justとMakeの比較については以下の記事に共感できる内容が記載されている：
https://glinteco.com/ja/post/comparing-makefile-and-just-which-one-should-you-choose/